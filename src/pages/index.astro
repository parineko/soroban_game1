---
// index.astro
// テストモード追加版
import BaseLayout from "../layouts/BaseLayout.astro";
import StartScreen from "../components/StartScreen.astro";
import LevelSelect from "../components/LevelSelect.astro";
import GameScreen from "../components/GameScreen.astro";
import ResultScreen from "../components/ResultScreen.astro";
import KukuSelect from "../components/KukuSelect.astro";
import KukuScreen from "../components/KukuScreen.astro";
import KukuGame from "../components/KukuGame.astro"; // ★追加
---

<BaseLayout showHeader={false}>
  <StartScreen />
  <LevelSelect />
  <GameScreen />
  <ResultScreen />
  <KukuSelect />
  <KukuScreen />
  <KukuGame /> </BaseLayout>

<script>
  import "../scripts/gameController.js";

  document.addEventListener('DOMContentLoaded', () => {
    if (typeof window.GameController === 'function') {
      new window.GameController();
    }
  });

  document.addEventListener('click', (e) => {
    const btn = e.target.closest('button');
    if (!btn) return;
    const action = btn.getAttribute('data-action');
    if (!action) return;

    if (action === 'go-level') showScreen('level');
    else if (action === 'go-kuku') showScreen('kuku-select');
    else if (action === 'back-start') showScreen('start');
    else if (action === 'back-level') showScreen('level');
    else if (action === 'back-kuku-select') showScreen('kuku-select');
  });

  document.addEventListener('kuku-dan-selected', () => {
    showScreen('kuku'); // 覚えるモード
  });

  // ★追加：テストモード開始
  document.addEventListener('kuku-test-start', () => {
    showScreen('kuku-game'); // テストモード
  });

  function showScreen(name) {
    document.querySelectorAll('.screen').forEach(el => {
      el.style.display = 'none';
    });
    const target = document.querySelector(`[data-screen="${name}"]`);
    if (target) {
      target.style.display = 'flex';
      window.scrollTo(0, 0);
    }
  }
</script>