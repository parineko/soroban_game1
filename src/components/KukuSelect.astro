---
// KukuSelect.astro
// ã€Œè¦šãˆã‚‹ã€ã¨ã€Œãƒ†ã‚¹ãƒˆã€ã®åˆ†å²ã‚’è¿½åŠ 
---

<div class="screen kuku-select-screen" data-screen="kuku-select" style="display: none;">
  <div class="panel">
    <h2 class="section-title">ã©ã® ã ã‚“ã§ ã‚ãã¶ï¼Ÿ ğŸ’</h2>
    
    <div class="mode-switch">
      <button class="mode-btn active" id="mode-learn">ãŠã¼ãˆã‚‹ ğŸ“–</button>
      <button class="mode-btn" id="mode-test">ãƒ†ã‚¹ãƒˆ ğŸ²</button>
    </div>
    
    <div class="dan-grid">
      <button class="dan-btn" data-dan="2">2 ã®ã ã‚“</button>
      <button class="dan-btn" data-dan="3">3 ã®ã ã‚“</button>
      <button class="dan-btn" data-dan="4">4 ã®ã ã‚“</button>
      <button class="dan-btn" data-dan="5">5 ã®ã ã‚“</button>
      <button class="dan-btn" data-dan="6">6 ã®ã ã‚“</button>
      <button class="dan-btn" data-dan="7">7 ã®ã ã‚“</button>
      <button class="dan-btn" data-dan="8">8 ã®ã ã‚“</button>
      <button class="dan-btn" data-dan="9">9 ã®ã ã‚“</button>
    </div>

    <div class="button-row">
      <button class="btn sub-btn" data-action="back-start" aria-label="ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹">ã‚‚ã©ã‚‹ ğŸ </button>
    </div>
  </div>
</div>

<style>
  .kuku-select-screen {
    width: 100%; height: 100%;
    display: flex; justify-content: center; align-items: center;
  }
  .panel {
    width: 100%; max-width: 500px;
    padding: 20px; display: flex; flex-direction: column; align-items: center;
  }
  .section-title {
    font-size: 1.8rem; color: #b71c1c; margin-bottom: 20px;
  }

  /* ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ãƒœã‚¿ãƒ³ */
  .mode-switch {
    display: flex; gap: 10px; margin-bottom: 20px;
    background: #e0e0e0; padding: 5px; border-radius: 30px;
  }
  .mode-btn {
    padding: 10px 30px; border-radius: 25px; border: none;
    font-size: 1.2rem; font-weight: bold; cursor: pointer;
    background: transparent; color: #757575;
    transition: all 0.2s;
  }
  .mode-btn.active {
    background: #fff; color: #d81b60;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  /* ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªæ™‚ */
  .mode-btn#mode-test.active {
    color: #1976d2;
  }

  .dan-grid {
    display: grid; grid-template-columns: repeat(2, 1fr);
    gap: 15px; width: 100%; margin-bottom: 30px;
  }
  .dan-btn {
    background: #fff; border: 3px solid #ff8a80;
    border-radius: 12px; padding: 15px;
    font-size: 1.5rem; font-weight: bold; color: #b71c1c;
    cursor: pointer; font-family: 'SorobanFont', sans-serif !important;
  }
  .dan-btn:active { transform: scale(0.95); background: #ffe6e6; }
  
  /* ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰æ™‚ã®ãƒœã‚¿ãƒ³è‰²å¤‰åŒ–ç”¨ã‚¯ãƒ©ã‚¹ */
  :global(.test-mode .dan-btn) {
    border-color: #64b5f6; color: #0d47a1;
  }
  :global(.test-mode .dan-btn:active) {
    background: #e3f2fd;
  }

  .btn.sub-btn {
    background: #f0e0c8; color: #5d4037; border: 1px solid #d4c4b0;
    padding: 10px 20px; border-radius: 8px; cursor: pointer;
  }
</style>

<script>
  let currentMode = 'learn'; // 'learn' or 'test'

  const modeBtns = document.querySelectorAll('.mode-btn');
  const panel = document.querySelector('.kuku-select-screen .panel');

  modeBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      // è¦‹ãŸç›®ã®åˆ‡ã‚Šæ›¿ãˆ
      modeBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      // ãƒ¢ãƒ¼ãƒ‰è¨­å®š
      if (btn.id === 'mode-test') {
        currentMode = 'test';
        panel.classList.add('test-mode');
      } else {
        currentMode = 'learn';
        panel.classList.remove('test-mode');
      }
    });
  });

  // æ®µãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
  document.addEventListener('click', (e) => {
    const btn = e.target.closest('.dan-btn');
    if (!btn) return;
    
    const dan = btn.getAttribute('data-dan');
    if (dan) {
      if (currentMode === 'learn') {
        // è¦šãˆã‚‹ãƒ¢ãƒ¼ãƒ‰ã¸
        const event = new CustomEvent('kuku-dan-selected', { detail: { dan: parseInt(dan) } });
        document.dispatchEvent(event);
      } else {
        // â˜…ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã¸ (æ–°ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆ)
        const event = new CustomEvent('kuku-test-start', { detail: { dan: parseInt(dan) } });
        document.dispatchEvent(event);
      }
    }
  });
</script>