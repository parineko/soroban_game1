---
// KukuSelect.astro
// ã€Œè¦šãˆã‚‹ã€ã¨ã€Œãƒ†ã‚¹ãƒˆã€ã®ç‹¬ç«‹ãƒœã‚¿ãƒ³åŒ– + 1ã®æ®µè¿½åŠ 
---

<div class="screen kuku-select-screen" data-screen="kuku-select" style="display: none;">
  <div class="panel">
    <h2 class="section-title">ã©ã® ã ã‚“ã§ ã‚ãã¶ï¼Ÿ ğŸ’</h2>
    
    <div class="mode-selection">
      <div class="mode-desc">ãƒ¢ãƒ¼ãƒ‰ã‚’ãˆã‚‰ã‚“ã§ã­ğŸ‘‡</div>
      <div class="mode-buttons">
        <button class="mode-btn active" id="mode-learn">ãŠã¼ãˆã‚‹ ğŸ“–</button>
        <button class="mode-btn" id="mode-test">ãƒ†ã‚¹ãƒˆ ğŸ²</button>
      </div>
    </div>
    
    <div class="dan-grid">
      <button class="dan-btn" data-dan="1">1 ã®ã ã‚“</button>
      <button class="dan-btn" data-dan="2">2 ã®ã ã‚“</button>
      <button class="dan-btn" data-dan="3">3 ã®ã ã‚“</button>
      <button class="dan-btn" data-dan="4">4 ã®ã ã‚“</button>
      <button class="dan-btn" data-dan="5">5 ã®ã ã‚“</button>
      <button class="dan-btn" data-dan="6">6 ã®ã ã‚“</button>
      <button class="dan-btn" data-dan="7">7 ã®ã ã‚“</button>
      <button class="dan-btn" data-dan="8">8 ã®ã ã‚“</button>
      <button class="dan-btn" data-dan="9">9 ã®ã ã‚“</button>
    </div>

    <div class="button-row">
      <button class="btn sub-btn" data-action="back-start" aria-label="ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹">ã‚‚ã©ã‚‹ ğŸ </button>
    </div>
  </div>
</div>

<style>
  .kuku-select-screen {
    width: 100%; height: 100%;
    display: flex; justify-content: center; align-items: center;
  }
  .panel {
    width: 100%; max-width: 500px; padding: 20px;
    display: flex; flex-direction: column; align-items: center;
  }
  .section-title {
    font-size: 1.8rem; color: #b71c1c; margin-bottom: 10px;
  }

  .mode-selection {
    width: 100%; text-align: center; margin-bottom: 20px;
  }
  .mode-desc {
    font-size: 1.1rem; color: #795548; margin-bottom: 8px; font-weight: bold;
  }
  .mode-buttons {
    display: flex; gap: 15px; justify-content: center;
  }
  .mode-btn {
    flex: 1; padding: 12px 0; border-radius: 12px; border: 3px solid #ccc;
    font-size: 1.3rem; font-weight: bold; cursor: pointer;
    background: #fff; color: #888; transition: all 0.2s;
    box-shadow: 0 4px 0 #ccc;
  }
  .mode-btn:active {
    transform: translateY(4px); box-shadow: 0 0 0 #ccc;
  }
  
  /* ãŠã¼ãˆã‚‹ãƒ¢ãƒ¼ãƒ‰é¸æŠæ™‚ */
  .mode-btn#mode-learn.active {
    border-color: #ff8a80; color: #d81b60; background: #ffebee;
    box-shadow: 0 4px 0 #ff8a80;
  }
  .mode-btn#mode-learn.active:active { transform: translateY(4px); box-shadow: 0 0 0 #ff8a80; }

  /* ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰é¸æŠæ™‚ */
  .mode-btn#mode-test.active {
    border-color: #64b5f6; color: #1565c0; background: #e3f2fd;
    box-shadow: 0 4px 0 #64b5f6;
  }
  .mode-btn#mode-test.active:active { transform: translateY(4px); box-shadow: 0 0 0 #64b5f6; }

  .dan-grid {
    display: grid; grid-template-columns: repeat(2, 1fr);
    gap: 15px; width: 100%; margin-bottom: 30px;
  }
  .dan-btn {
    background: #fff; border: 3px solid #ff8a80; border-radius: 12px; padding: 15px;
    font-size: 1.5rem; font-weight: bold; color: #b71c1c;
    cursor: pointer; font-family: 'SorobanFont', sans-serif !important;
  }
  .dan-btn:active { transform: scale(0.95); background: #ffe6e6; }
  
  :global(.test-mode .dan-btn) { border-color: #64b5f6; color: #0d47a1; }
  :global(.test-mode .dan-btn:active) { background: #e3f2fd; }

  .btn.sub-btn {
    background: #f0e0c8; color: #5d4037; border: 1px solid #d4c4b0;
    padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight:bold;
  }
</style>

<script>
  let currentMode = 'learn';

  const modeBtns = document.querySelectorAll('.mode-btn');
  const panel = document.querySelector('.kuku-select-screen .panel');

  modeBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      modeBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      if (btn.id === 'mode-test') {
        currentMode = 'test';
        panel.classList.add('test-mode');
      } else {
        currentMode = 'learn';
        panel.classList.remove('test-mode');
      }
    });
  });

  document.addEventListener('click', (e) => {
    const btn = e.target.closest('.dan-btn');
    if (!btn) return;
    
    const dan = btn.getAttribute('data-dan');
    if (dan) {
      if (currentMode === 'learn') {
        const event = new CustomEvent('kuku-dan-selected', { detail: { dan: parseInt(dan) } });
        document.dispatchEvent(event);
      } else {
        const event = new CustomEvent('kuku-test-start', { detail: { dan: parseInt(dan) } });
        document.dispatchEvent(event);
      }
    }
  });
</script>